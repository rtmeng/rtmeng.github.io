<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art & Design Portfolio</title>
    <link rel="stylesheet" href="css/design-portfolio-style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
    <!-- 3D Model Section -->
    <section class="model-section" id="model-section">
        <p class="back-link-arrow">←</p><a href="index.html" class="back-link"> Back to Home</a>
        
        <header class="header">
            <h1>Art & Design Portfolio</h1>
            <p>Interactive CAD Castle Model - the start of my 3D design work</p>
        </header>
        
        <div class="model-container">
            <div id="castle-viewer"></div>
            <div class="loading-text" id="loading-text">Loading 3D Model...</div>
        </div>
        
        <div class="controls-info">
            Click and drag to rotate • Scroll to zoom • Right-click and drag to pan
        </div>
        
        <div class="scroll-arrow" onclick="scrollToGallery()">
            ↓
        </div>
    </section>

    <!-- Portfolio Gallery Section -->
    <section class="car-gallery" id="car-gallery">
        <div class="car-gallery-header">
            <h2 style="color: #fafafa">Portfolio Gallery</h2>
            <p><i>Explore my collection of design work and creative projects with the</i> University of Michigan Solar Car Team</p>
        </div>
        
        <div class="car-photo-grid">
            <div class="car-photo-item"><img src="/images/millennium_tail_candy_corn_white_canopy.png" style="width: 560px;"></div>
            <div class="car-photo-item"><img src="/images/millennium_tail_dani.png" style="width: 560px;"></div>
            <div class="car-photo-item"><img src="/images/millennium_tail_wave.png" style="width: 560px;"></div>
            <div class="car-photo-item"><img src="/images/millie_for_luis.png" style="width: 560px;"></div>
            <div class="car-photo-item"><img src="/images/millennium_semi_final_option1.png" style="width: 560px;"></div>
            <div class="car-photo-item"><img src="/images/millennium_semi_final_option3.png" style="width: 560px;"></div>
            <div class="car-photo-item"><img src="/images/millennium_semi_final_option4.png" style="width: 560px;"></div>
            <div class="car-photo-item"><img src="/images/millennium_tail_sundial_white_fin_canopy.png" style="width: 560px;"></div>

        </div>
    </section>

    <!-- Portfolio Gallery Section -->
    <section class="portfolio-gallery" id="portfolio-gallery">
        <div class="gallery-header">
            <h2 style="color: #fafafa">Portfolio Gallery</h2>
            <p>Explore my collection of design work, architectural models, and creative projects: <i>drag to dig through my artwork</i></p>
        </div>


        <div class="picture-frames" data-frame="true">
        <img src="./images/frame1.png" alt="Description of your image" style="width: 34%; height: auto;">
        <img src="./images/frame3.png" alt="Description of your image" style="max-height: 370px; width: auto;">
        <img src="./images/frame5.png" alt="Description of your image" style="max-height: 370px; width: auto;">
        <img src="./images/frame6.png" alt="Description of your image" style="max-width: 40%; height: auto;">
        <img src="./images/frame7.png" alt="Description of your image" style="max-width: 40%; height: auto;">
        </div>


    </section>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
        ↑
    </button>

    <script>
        // 3D Scene Setup
        let scene, camera, renderer, controls;
        let castle;
        const loader = new THREE.GLTFLoader();
        
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            // Position camera at upward angle
            const distance = 8;
            const height = distance * Math.sin(Math.PI / 450);
            const horizontalDistance = distance * Math.cos(Math.PI / 450);
            
            camera.position.set(horizontalDistance, height, horizontalDistance);
            camera.lookAt(0, 0, 0);
            
            // Create renderer
            const container = document.getElementById('castle-viewer');
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Add orbit controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enableZoom = true;
            controls.enablePan = true;
            
            // Load the castle model
            loadCastleModel();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
            
            // Start animation loop
            animate();
        }
        
        function loadCastleModel() {            
            // Load your Cinderella Castle model
            loader.load('models/cinderella_castle_3.glb', 
                function(gltf) {
                    castle = gltf.scene;
                    castle.scale.set(1, 1, 1);
                    castle.position.set(-25, -38, -25);
                    scene.add(castle);
                    
                    // Hide loading text
                    document.getElementById('loading-text').style.display = 'none';
                },
                function(progress) {
                    if (progress.total > 0) {
                        const percentComplete = (progress.loaded / progress.total) * 100;
                        console.log('Loading progress: ', percentComplete.toFixed(1) + '%');
                    } else {
                        console.log('Loading progress: ', progress.loaded + ' bytes loaded');
                    }
                },
                function(error) {
                    console.error('Error loading model:', error);
                    document.getElementById('loading-text').textContent = 'Error loading model. Please check the file path.';
                }
            );
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Scroll Functions
        function scrollToGallery() {
            document.getElementById('portfolio-gallery').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        function scrollToTop() {
            document.getElementById('model-section').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // Show/Hide Back to Top Button and Handle Header Changes
        window.addEventListener('scroll', function() {
            const backToTopButton = document.getElementById('backToTop');
            const scrollArrow = document.querySelector('.scroll-arrow');
            const controlsInfo = document.querySelector('.controls-info');
            const header = document.querySelector('.header');
            const gallerySection = document.getElementById('portfolio-gallery');
            
            // Get the position of the gallery section
            const galleryRect = gallerySection.getBoundingClientRect();
            const isGalleryVisible = galleryRect.top <= window.innerHeight * (2.0 / 3.0);
            
            // Handle back to top button
            if (window.scrollY > window.innerHeight / 2) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
            
            // Handle scroll arrow and controls info visibility
            if (isGalleryVisible) {
                scrollArrow.classList.add('hidden');
                controlsInfo.classList.add('hidden');
            } else {
                scrollArrow.classList.remove('hidden');
                controlsInfo.classList.remove('hidden');
            }
            
            // Handle header content change
            if (isGalleryVisible) {
                header.innerHTML = '<h1>Portfolio Gallery</h1><p>Explore my collection of design work</p>';
            } else {
                header.innerHTML = '<h1>Art & Design Portfolio</h1><p>Interactive 3D Castle Model - a start of my CAD design work</p>';
            }
        });
        
        // Initialize when page loads
        window.addEventListener('load', init);





        (function () {
            const stage = document.querySelector('.picture-frames[data-frame="true"]');
            if (!stage) return;

            if (getComputedStyle(stage).position === 'static') {
            stage.style.position = 'relative';
            }

            const imgs = Array.from(stage.querySelectorAll('img'));
            let dragging = null, startX = 0, startY = 0, baseLeft = 0, baseTop = 0, zTop = 1;

            function px(n) { return n + 'px'; }
            function clamp(v, min, max) { return Math.max(min, Math.min(v, max)); }

            function absolutize(img) {
            const s = getComputedStyle(img);

            if (s.position === 'absolute' && s.left.endsWith('px') && s.top.endsWith('px')) {
                img.classList.add('draggable');
                return;
            }

            const rect = img.getBoundingClientRect();
            const stageRect = stage.getBoundingClientRect();

            const left = rect.left - stageRect.left + stage.scrollLeft;
            const top  = rect.top  - stageRect.top  + stage.scrollTop;

            img.classList.add('draggable');
            img.style.position = 'absolute';
            img.style.left = px(left);
            img.style.top  = px(top);
            img.style.margin = '0';
            }

            const stageRect = stage.getBoundingClientRect();
            const stageCenterX = stageRect.width / 2;
            const stageCenterY = stageRect.height / 390;

            function absolutize(img, i) {
                const s = getComputedStyle(img);

                if (s.position === 'absolute' && s.left.endsWith('px') && s.top.endsWith('px')) {
                    img.classList.add('draggable');
                    return;
                }

                const rect = img.getBoundingClientRect();

                const imgWidth = rect.width;
                const imgHeight = rect.height;

                const offset = i * 20;
                const left = stageCenterX - imgWidth / 2 + offset;
                const top  = stageCenterY - imgHeight / 2 + offset;

                img.classList.add('draggable');
                img.style.position = 'absolute';
                img.style.left = px(left);
                img.style.top  = px(top);
                img.style.margin = '0';
            }
            imgs.forEach((img, i) => absolutize(img, i));

            function onDown(e) {
            dragging = e.currentTarget;
            dragging.classList.add('dragging');
            dragging.style.zIndex = String(++zTop);

            startX = e.clientX;
            startY = e.clientY;
            baseLeft = parseFloat(dragging.style.left) || 0;
            baseTop  = parseFloat(dragging.style.top)  || 0;

            dragging.setPointerCapture?.(e.pointerId);
            }

            function onMove(e) {
            if (!dragging) return;

            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            const stageRect = stage.getBoundingClientRect();
            const elWidth = dragging.offsetWidth;
            const elHeight = dragging.offsetHeight;

            let nextLeft = baseLeft + dx;
            let nextTop  = baseTop  + dy;

            const maxLeft = stageRect.width  - elWidth;
            const maxTop  = stageRect.height - elHeight;

            dragging.style.left = px(clamp(nextLeft, 0, Math.max(0, maxLeft)));
            dragging.style.top  = px(clamp(nextTop,  0, Math.max(0, maxTop)));
            }

            function onUp(e) {
            if (!dragging) return;
            dragging.classList.remove('dragging');
            dragging.releasePointerCapture?.(e.pointerId);
            dragging = null;
            }

            imgs.forEach(img => {
            img.addEventListener('pointerdown', onDown);
            img.addEventListener('pointermove', onMove);
            img.addEventListener('pointerup', onUp);
            img.addEventListener('pointercancel', onUp);
            img.addEventListener('lostpointercapture', onUp);
            });
        })();
    </script>
</body>
</html>